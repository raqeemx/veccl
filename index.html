<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>نموذج تقييم مركبة مستردّة - محسّن | Enhanced Vehicle Evaluation</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/dist/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <link rel="stylesheet" href="css/style-enhanced.css">
</head>
<body>
    <!-- Dark Mode Toggle Button (Fixed Position) -->
    <button id="darkModeToggle" class="dark-mode-toggle no-print" title="تبديل الوضع الليلي">
        <i class="fas fa-moon"></i>
    </button>

    <!-- Auto-save Status -->
    <div id="autoSaveStatus" class="auto-save-status no-print"></div>

    <!-- Notification Container -->
    <div id="notificationContainer" class="notification-container no-print"></div>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay" style="display: none;">
        <div class="loading-spinner"></div>
        <p>جاري المعالجة... | Processing...</p>
    </div>

    <div class="container">
        <!-- Header -->
        <header class="form-header">
            <div class="logo-placeholder">
                <i class="fas fa-car"></i>
            </div>
            <div class="header-titles">
                <h1>نموذج تقييم مركبة مستردّة - محسّن</h1>
                <h2>Enhanced Repossessed Vehicle Evaluation Form</h2>
            </div>
            <div class="form-number">
                <span>رقم النموذج | Form #:</span>
                <input type="text" id="formNumber" readonly>
            </div>
        </header>

        <!-- Form Content -->
        <form id="vehicleEvaluationForm">
            <!-- Section 1: Basic Information -->
            <section class="form-section">
                <div class="section-header">
                    <span class="section-number">1</span>
                    <h3>البيانات الأساسية <span class="en-title">Basic Information</span></h3>
                </div>
                <div class="section-content">
                    <div class="info-grid">
                        <div class="info-row">
                            <div class="info-item">
                                <label>رقم العقد | Contract No. <span class="required">*</span></label>
                                <input type="text" name="contractNo" id="contractNo" data-required="true">
                                <span class="error-message"></span>
                            </div>
                            <div class="info-item">
                                <label>رقم الهيكل (VIN) <span class="required">*</span></label>
                                <input type="text" name="vin" id="vin" maxlength="17" data-required="true">
                                <span class="error-message"></span>
                            </div>
                        </div>
                        <div class="info-row">
                            <div class="info-item">
                                <label>اسم العميل | Customer Name <span class="required">*</span></label>
                                <input type="text" name="customerName" id="customerName" data-required="true">
                                <span class="error-message"></span>
                            </div>
                            <div class="info-item">
                                <label>قراءة العداد | Odometer (km)</label>
                                <input type="number" name="odometer" id="odometer">
                            </div>
                        </div>
                        <div class="info-row">
                            <div class="info-item">
                                <label>نوع المركبة | Make <span class="required">*</span></label>
                                <input type="text" name="make" id="make" data-required="true">
                                <span class="error-message"></span>
                            </div>
                            <div class="info-item">
                                <label>لون المركبة | Color</label>
                                <input type="text" name="color" id="color">
                            </div>
                        </div>
                        <div class="info-row">
                            <div class="info-item">
                                <label>الموديل | Model <span class="required">*</span></label>
                                <input type="text" name="model" id="model" data-required="true">
                                <span class="error-message"></span>
                            </div>
                            <div class="info-item">
                                <label>تاريخ الاسترداد | Repo Date</label>
                                <input type="date" name="repoDate" id="repoDate">
                            </div>
                        </div>
                        <div class="info-row">
                            <div class="info-item">
                                <label>سنة الصنع | Year <span class="required">*</span></label>
                                <input type="number" name="year" id="year" min="1990" max="2030" data-required="true">
                                <span class="error-message"></span>
                            </div>
                            <div class="info-item">
                                <label>موقع الاسترداد | Repo Location</label>
                                <input type="text" name="repoLocation" id="repoLocation">
                            </div>
                        </div>
                        <div class="info-row">
                            <div class="info-item">
                                <label>رقم اللوحة | Plate No.</label>
                                <input type="text" name="plateNo" id="plateNo">
                            </div>
                            <div class="info-item">
                                <label>نوع الوقود | Fuel Type</label>
                                <select name="fuelType" id="fuelType">
                                    <option value="">اختر... | Select...</option>
                                    <option value="petrol">بنزين | Petrol</option>
                                    <option value="diesel">ديزل | Diesel</option>
                                    <option value="hybrid">هجين | Hybrid</option>
                                    <option value="electric">كهربائي | Electric</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Section 2: Technical Evaluation -->
            <section class="form-section">
                <div class="section-header">
                    <span class="section-number">2</span>
                    <h3>تقييم الحالة الفنية <span class="en-title">Technical Condition Evaluation</span></h3>
                </div>
                <div class="section-content">
                    <table class="evaluation-table">
                        <thead>
                            <tr>
                                <th class="item-col">البند | Item</th>
                                <th class="rating-col">ممتاز<br><span class="en-text">Excellent</span></th>
                                <th class="rating-col">جيد<br><span class="en-text">Good</span></th>
                                <th class="rating-col">ضعيف<br><span class="en-text">Poor</span></th>
                                <th class="notes-col">ملاحظات | Notes</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td class="item-name">الهيكل الخارجي | Body</td>
                                <td class="rating-cell"><input type="radio" name="body" value="excellent"></td>
                                <td class="rating-cell"><input type="radio" name="body" value="good"></td>
                                <td class="rating-cell"><input type="radio" name="body" value="poor"></td>
                                <td class="notes-cell"><input type="text" name="bodyNotes"></td>
                            </tr>
                            <tr>
                                <td class="item-name">الإطارات | Tires</td>
                                <td class="rating-cell"><input type="radio" name="tires" value="excellent"></td>
                                <td class="rating-cell"><input type="radio" name="tires" value="good"></td>
                                <td class="rating-cell"><input type="radio" name="tires" value="poor"></td>
                                <td class="notes-cell"><input type="text" name="tiresNotes"></td>
                            </tr>
                            <tr>
                                <td class="item-name">الإضاءة | Lights</td>
                                <td class="rating-cell"><input type="radio" name="lights" value="excellent"></td>
                                <td class="rating-cell"><input type="radio" name="lights" value="good"></td>
                                <td class="rating-cell"><input type="radio" name="lights" value="poor"></td>
                                <td class="notes-cell"><input type="text" name="lightsNotes"></td>
                            </tr>
                            <tr>
                                <td class="item-name">المقاعد والتنجيد | Seats</td>
                                <td class="rating-cell"><input type="radio" name="seats" value="excellent"></td>
                                <td class="rating-cell"><input type="radio" name="seats" value="good"></td>
                                <td class="rating-cell"><input type="radio" name="seats" value="poor"></td>
                                <td class="notes-cell"><input type="text" name="seatsNotes"></td>
                            </tr>
                            <tr>
                                <td class="item-name">الزجاج | Glass</td>
                                <td class="rating-cell"><input type="radio" name="glass" value="excellent"></td>
                                <td class="rating-cell"><input type="radio" name="glass" value="good"></td>
                                <td class="rating-cell"><input type="radio" name="glass" value="poor"></td>
                                <td class="notes-cell"><input type="text" name="glassNotes"></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Section 3: Damage Assessment -->
            <section class="form-section">
                <div class="section-header">
                    <span class="section-number">3</span>
                    <h3>تقييم الأضرار <span class="en-title">Damage Assessment</span></h3>
                </div>
                <div class="section-content">
                    <div class="damage-grid">
                        <div class="damage-item">
                            <label>
                                <input type="checkbox" name="damages" value="scratches">
                                <span>خدوش | Scratches</span>
                            </label>
                        </div>
                        <div class="damage-item">
                            <label>
                                <input type="checkbox" name="damages" value="dents">
                                <span>انبعاجات | Dents</span>
                            </label>
                        </div>
                        <div class="damage-item">
                            <label>
                                <input type="checkbox" name="damages" value="rust">
                                <span>صدأ | Rust</span>
                            </label>
                        </div>
                        <div class="damage-item">
                            <label>
                                <input type="checkbox" name="damages" value="cracked_glass">
                                <span>زجاج متصدع | Cracked Glass</span>
                            </label>
                        </div>
                        <div class="damage-item">
                            <label>
                                <input type="checkbox" name="damages" value="missing_parts">
                                <span>أجزاء مفقودة | Missing Parts</span>
                            </label>
                        </div>
                        <div class="damage-item">
                            <label>
                                <input type="checkbox" name="damages" value="accident_damage">
                                <span>أضرار حادث | Accident Damage</span>
                            </label>
                        </div>
                    </div>
                    <div class="damage-details">
                        <label>تفاصيل الأضرار | Damage Details:</label>
                        <textarea name="damageDetails" id="damageDetails" rows="4" placeholder="اذكر تفاصيل الأضرار الموجودة..."></textarea>
                    </div>
                </div>
            </section>

            <!-- Section 4: Accessories -->
            <section class="form-section">
                <div class="section-header">
                    <span class="section-number">4</span>
                    <h3>الملحقات والمعدات <span class="en-title">Accessories & Equipment</span></h3>
                </div>
                <div class="section-content">
                    <div class="accessories-grid">
                        <div class="accessory-item">
                            <label>
                                <input type="checkbox" name="accessories" value="spare_tire">
                                <span>إطار احتياطي | Spare Tire</span>
                            </label>
                        </div>
                        <div class="accessory-item">
                            <label>
                                <input type="checkbox" name="accessories" value="jack">
                                <span>رافعة | Jack</span>
                            </label>
                        </div>
                        <div class="accessory-item">
                            <label>
                                <input type="checkbox" name="accessories" value="tools">
                                <span>عدة أدوات | Tool Kit</span>
                            </label>
                        </div>
                        <div class="accessory-item">
                            <label>
                                <input type="checkbox" name="accessories" value="first_aid">
                                <span>حقيبة إسعاف | First Aid</span>
                            </label>
                        </div>
                        <div class="accessory-item">
                            <label>
                                <input type="checkbox" name="accessories" value="fire_extinguisher">
                                <span>طفاية حريق | Fire Ext.</span>
                            </label>
                        </div>
                        <div class="accessory-item">
                            <label>
                                <input type="checkbox" name="accessories" value="manual">
                                <span>دليل المستخدم | Manual</span>
                            </label>
                        </div>
                        <div class="accessory-item">
                            <label>
                                <input type="checkbox" name="accessories" value="keys">
                                <span>المفاتيح | Keys</span>
                            </label>
                        </div>
                        <div class="accessory-item">
                            <label>
                                <input type="checkbox" name="accessories" value="registration">
                                <span>استمارة | Registration</span>
                            </label>
                        </div>
                    </div>
                    <div class="keys-count-container" id="keysCountContainer" style="display: none;">
                        <label>عدد المفاتيح | Number of Keys:</label>
                        <input type="number" name="keysCount" id="keysCount" min="0" max="10" placeholder="0">
                    </div>
                </div>
            </section>

            <!-- Section 5: Financial Valuation -->
            <section class="form-section">
                <div class="section-header">
                    <span class="section-number">5</span>
                    <h3>التقييم المالي <span class="en-title">Financial Valuation</span></h3>
                </div>
                <div class="section-content">
                    <div class="valuation-single">
                        <div class="valuation-item">
                            <label>القيمة السوقية التقديرية | Estimated Market Value</label>
                            <div class="currency-input">
                                <input type="number" name="marketValue" id="marketValue" min="0" step="100">
                                <span class="currency">ر.س | SAR</span>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Section 6: Overall Assessment -->
            <section class="form-section">
                <div class="section-header">
                    <span class="section-number">6</span>
                    <h3>التقييم العام <span class="en-title">Overall Assessment</span></h3>
                </div>
                <div class="section-content">
                    <div class="overall-rating">
                        <label>التقييم الإجمالي | Overall Rating:</label>
                        <div class="rating-options">
                            <label class="rating-option excellent">
                                <input type="radio" name="overallRating" value="excellent">
                                <span><i class="fas fa-star"></i> ممتاز | Excellent</span>
                            </label>
                            <label class="rating-option good">
                                <input type="radio" name="overallRating" value="good">
                                <span><i class="fas fa-star-half-alt"></i> جيد | Good</span>
                            </label>
                            <label class="rating-option fair">
                                <input type="radio" name="overallRating" value="fair">
                                <span><i class="fas fa-star"></i> مقبول | Fair</span>
                            </label>
                            <label class="rating-option poor">
                                <input type="radio" name="overallRating" value="poor">
                                <span><i class="fas fa-times-circle"></i> ضعيف | Poor</span>
                            </label>
                        </div>
                    </div>
                    <div class="recommendation">
                        <label>التوصية | Recommendation:</label>
                        <div class="recommendation-options">
                            <label>
                                <input type="radio" name="recommendation" value="sell_as_is">
                                <span>البيع كما هي | Sell As-Is</span>
                            </label>
                            <label>
                                <input type="radio" name="recommendation" value="repair_sell">
                                <span>الإصلاح ثم البيع | Repair & Sell</span>
                            </label>
                            <label>
                                <input type="radio" name="recommendation" value="auction">
                                <span>البيع في المزاد | Auction</span>
                            </label>
                            <label>
                                <input type="radio" name="recommendation" value="scrap">
                                <span>التخريد | Scrap</span>
                            </label>
                        </div>
                    </div>
                    <div class="additional-notes">
                        <label>ملاحظات إضافية | Additional Notes:</label>
                        <textarea name="additionalNotes" id="additionalNotes" rows="4"></textarea>
                    </div>
                </div>
            </section>

            <!-- Section 7: Vehicle Photos -->
            <section class="form-section">
                <div class="section-header">
                    <span class="section-number">7</span>
                    <h3>صور المركبة <span class="en-title">Vehicle Photos</span></h3>
                </div>
                <div class="section-content">
                    <div class="photos-grid">
                        <div class="photo-box">
                            <label>الصورة الأولى | Photo 1</label>
                            <div class="photo-upload" id="photoUpload1" onclick="document.getElementById('photo1').click()">
                                <input type="file" id="photo1" name="photo1" accept="image/*" onchange="previewImage(this, 'preview1')" hidden>
                                <div class="photo-preview" id="preview1">
                                    <i class="fas fa-camera"></i>
                                    <span>اضغط لإضافة صورة<br><small>Max 5MB</small></span>
                                </div>
                            </div>
                            <button type="button" class="btn-remove-photo" onclick="removeImage('photo1', 'preview1')" style="display:none;" id="removeBtn1">
                                <i class="fas fa-trash"></i> حذف
                            </button>
                        </div>
                        <div class="photo-box">
                            <label>الصورة الثانية | Photo 2</label>
                            <div class="photo-upload" id="photoUpload2" onclick="document.getElementById('photo2').click()">
                                <input type="file" id="photo2" name="photo2" accept="image/*" onchange="previewImage(this, 'preview2')" hidden>
                                <div class="photo-preview" id="preview2">
                                    <i class="fas fa-camera"></i>
                                    <span>اضغط لإضافة صورة<br><small>Max 5MB</small></span>
                                </div>
                            </div>
                            <button type="button" class="btn-remove-photo" onclick="removeImage('photo2', 'preview2')" style="display:none;" id="removeBtn2">
                                <i class="fas fa-trash"></i> حذف
                            </button>
                        </div>
                        <div class="photo-box">
                            <label>الصورة الثالثة | Photo 3</label>
                            <div class="photo-upload" id="photoUpload3" onclick="document.getElementById('photo3').click()">
                                <input type="file" id="photo3" name="photo3" accept="image/*" onchange="previewImage(this, 'preview3')" hidden>
                                <div class="photo-preview" id="preview3">
                                    <i class="fas fa-camera"></i>
                                    <span>اضغط لإضافة صورة<br><small>Max 5MB</small></span>
                                </div>
                            </div>
                            <button type="button" class="btn-remove-photo" onclick="removeImage('photo3', 'preview3')" style="display:none;" id="removeBtn3">
                                <i class="fas fa-trash"></i> حذف
                            </button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Section 8: Signature -->
            <section class="form-section">
                <div class="section-header">
                    <span class="section-number">8</span>
                    <h3>التوقيع <span class="en-title">Signature</span></h3>
                </div>
                <div class="section-content">
                    <div class="signatures-single">
                        <div class="signature-box">
                            <label>المقيّم | Evaluator</label>
                            <input type="text" name="evaluatorName" placeholder="الاسم | Name">
                            <input type="text" name="evaluatorId" placeholder="رقم الموظف | Employee ID">
                            <div class="signature-line">
                                <span>التوقيع | Signature</span>
                            </div>
                        </div>
                    </div>
                    <div class="date-stamp">
                        <label>تاريخ التقييم | Evaluation Date:</label>
                        <input type="date" name="evaluationDate" id="evaluationDate">
                    </div>
                </div>
            </section>

            <!-- Action Buttons -->
            <div class="form-actions">
                <button type="button" class="btn btn-success" onclick="saveForm()">
                    <i class="fas fa-save"></i> حفظ | Save
                </button>
                <button type="button" class="btn btn-primary" onclick="printForm()">
                    <i class="fas fa-print"></i> طباعة | Print
                </button>
                <button type="button" class="btn btn-pdf" onclick="exportToPDF()">
                    <i class="fas fa-file-pdf"></i> تصدير PDF
                </button>
                <button type="button" class="btn btn-excel" onclick="exportToExcel()">
                    <i class="fas fa-file-excel"></i> تصدير Excel
                </button>
                <button type="button" class="btn btn-json" onclick="exportToJSON()">
                    <i class="fas fa-download"></i> JSON
                </button>
                <button type="button" class="btn btn-import" onclick="document.getElementById('importFile').click()">
                    <i class="fas fa-upload"></i> استيراد | Import
                </button>
                <input type="file" id="importFile" accept=".json" onchange="importFromJSON(this)" style="display: none;">
                <button type="reset" class="btn btn-secondary" onclick="handleReset()">
                    <i class="fas fa-redo"></i> مسح | Reset
                </button>
            </div>
        </form>

        <!-- Footer -->
        <footer class="form-footer">
            <p>© 2024 نموذج تقييم المركبات المستردة | Vehicle Evaluation System</p>
            <p class="footer-features">Enhanced with Auto-save • Dark Mode • Advanced Export</p>
        </footer>
    </div>

    <script src="js/main-enhanced.js"></script>
</body>
</html>